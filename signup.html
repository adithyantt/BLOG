<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NoCap Press - Sign Up</title>
  <link rel="stylesheet" href="login.css" /> <!-- Uniform style for both pages -->
  <style>
    /* Error style for immediate feedback */
    #error {
      color: red;
      margin-bottom: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- Header Navigation -->
  <header class="header">
    <div class="header-left">
      <a href="index.html" class="logo-text">NoCapPress</a>
    </div>
    <div class="header-right">
      <a href="index.html" class="header-btn header-btn--home">Home</a>
      <a href="login.html" class="header-btn header-btn--signup">Login</a>
    </div>
  </header>

  <div class="main-content">
    <!-- Logo and Heading -->
    <div class="form-header">
      <h1>Write Your Thoughts, share it through NoCapPress.</h1>
    </div>

    <!-- Error Message -->
    <div id="error"></div>

    <!-- Registration Form -->
    <form method="POST" action="signup.php" onsubmit="return validateRegister()">

      <label for="u_name">Full Name</label>
      <input type="text" id="u_name" name="uname" placeholder="Enter your name" required oninput="capitalizeName()" />

      <label for="email">Email</label>
      <input type="email" id="email" name="email" placeholder="Enter your email" required />

      <label for="phone">Phone Number</label>
      <input type="text" id="phone" name="phone" placeholder="Enter your phone number" required />

      <label for="role">Select Role</label>
      <select name="role" id="role" required onchange="toggleAdminCode()">
        <option value="">Select Role</option>
        <option value="User">User</option>
        <option value="Admin">Admin</option>
      </select>

      <!-- Admin Code Field -->
      <div id="admin-code-box" style="display:none;">
        <label for="admin_code">Admin Code</label>
        <input type="text" id="admin_code" name="admin_code" placeholder="Enter Admin Code" />
      </div>

      <label for="password">Password</label>
      <div class="password-container">
        <input type="password" id="password" name="pwd" placeholder="Enter password" required />
        <span class="toggle" onclick="togglePassword()">Show</span>
      </div>

      <label for="confirm_password">Confirm Password</label>
      <div class="password-container">
        <input type="password" id="confirm_password" name="confirm_password" placeholder="Re-enter password" required />
        <span class="toggle" onclick="toggleConfirmPassword()">Show</span>
      </div>

      <button type="submit" name="submit">Sign Up</button>

      <p class="message">Already have an account? <a href="login.html">Login</a></p>
    </form>
  </div>

  <script>
    // Toggle Admin Code Box
    function toggleAdminCode() {
      const role = document.getElementById("role").value;
      const adminCodeBox = document.getElementById("admin-code-box");
      if (role === "Admin") {
        adminCodeBox.style.display = "block";
        adminCodeBox.classList.add("show");
      } else {
        adminCodeBox.style.display = "none";
        adminCodeBox.classList.remove("show");
      }
    }

    // Capitalize first letter of name
    function capitalizeName() {
      let nameInput = document.getElementById("u_name");
      if (nameInput.value.length > 0) {
        nameInput.value = nameInput.value.charAt(0).toUpperCase() + nameInput.value.slice(1);
      }
    }

    // Password show/hide toggles
    function togglePassword() {
      const passwordInput = document.getElementById("password");
      const toggleIcon = passwordInput.nextElementSibling;
      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        toggleIcon.textContent = "Hide";
      } else {
        passwordInput.type = "password";
        toggleIcon.textContent = "Show";
      }
    }

    function toggleConfirmPassword() {
      const confirmInput = document.getElementById("confirm_password");
      const toggleIcon = confirmInput.nextElementSibling;
      if (confirmInput.type === "password") {
        confirmInput.type = "text";
        toggleIcon.textContent = "Hide";
      } else {
        confirmInput.type = "password";
        toggleIcon.textContent = "Show";
      }
    }

    // Validate Form Input
    function validateRegister() {
      const uname = document.getElementById("u_name").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const role = document.getElementById("role").value;
      const password = document.getElementById("password").value.trim();
      const confirmPassword = document.getElementById("confirm_password").value.trim();
      const adminCode = document.getElementById("admin_code").value.trim();
      const errorDiv = document.getElementById("error");

      errorDiv.textContent = "";

      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
      const phonePattern = /^[0-9]{10}$/;

      if (!uname || !email || !phone || !role || !password || !confirmPassword) {
        errorDiv.textContent = "All fields are required.";
        return false;
      }

      if (!emailPattern.test(email)) {
        errorDiv.textContent = "Please enter a valid email address.";
        return false;
      }

      if (!phonePattern.test(phone)) {
        errorDiv.textContent = "Phone number must be exactly 10 digits.";
        return false;
      }
      // Strong password pattern: at least one letter, one number, one special char, min 6 chars
      const strongPasswordPattern = /^(?=.*[A-Za-z])(?=.*[0-9])(?=.*[!@#$%^&*]).{6,}$/;

      if (!strongPasswordPattern.test(password)) {
      errorDiv.textContent = 
      "Password must be at least 6 characters and include at least one letter, one number, and one special character.";
      return false;
      }


      if (password !== confirmPassword) {
        errorDiv.textContent = "Passwords do not match.";
        return false;
      }

      if (role === "Admin" && adminCode === "") {
        errorDiv.textContent = "Admin code is required.";
        return false;
      }

      return true;
    }
   // --- Autofill form from URL parameters (safe & normalized) ---
(function fillFromUrlParams() {
  const params = new URLSearchParams(window.location.search);
  if (!params) return;

  function safeSet(id, value, maxLen = 150) {
    if (!value) return;
    const el = document.getElementById(id);
    if (!el) return;
    el.value = String(value).trim().slice(0, maxLen);
  }

  const name = params.get('name');
  const email = params.get('email');
  const phone = params.get('phone');
  const role = params.get('role');

  safeSet('u_name', name, 100);
  safeSet('email', email, 200);
  safeSet('phone', phone, 20);

  if (role) {
    // convert 'admin' or 'user' to 'Admin' / 'User' to match <option>
    const normalized = role.charAt(0).toUpperCase() + role.slice(1).toLowerCase();
    const roleEl = document.getElementById('role');

    if (roleEl) {
      const exists = Array.from(roleEl.options).some(opt => opt.value === normalized);
      if (exists) {
        roleEl.value = normalized;
        toggleAdminCode(); // ensures admin code box appears
      }
    }
  }
})();

  </script>
</body>
</html>
